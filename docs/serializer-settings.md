<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /docs/mdsource/serializer-settings.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# Serializer settings

Serialization settings can be customized at three levels:

 * Method: Will run the verification in the current test method.
 * Class: Will run for all verifications in all test methods for a test class.
 * Global: Will run for test methods on all tests.

<!-- toc -->
## Contents

  * [Not valid json](#not-valid-json)
    * [UseStrictJson](#usestrictjson)
  * [Default settings](#default-settings)
  * [QuoteName is false](#quotename-is-false)
  * [Empty collections are ignored](#empty-collections-are-ignored)
  * [Guids are scrubbed](#guids-are-scrubbed)
  * [Dates are scrubbed](#dates-are-scrubbed)
  * [Default Booleans are ignored](#default-booleans-are-ignored)
  * [Change defaults at the verification level](#change-defaults-at-the-verification-level)
  * [Changing Json.NET settings](#changing-jsonnet-settings)
    * [Globally](#globally)
    * [Instance](#instance)
    * [Json.NET Converter](#jsonnet-converter)
  * [Scoped settings](#scoped-settings)
  * [Ignoring a type](#ignoring-a-type)
  * [Ignoring a instance](#ignoring-a-instance)
  * [Obsolete members ignored](#obsolete-members-ignored)
    * [Including Obsolete members](#including-obsolete-members)
  * [Ignore member by expressions](#ignore-member-by-expressions)
  * [Ignore member by name](#ignore-member-by-name)
  * [Members that throw](#members-that-throw)
  * [TreatAsString](#treatasstring)
  * [JsonAppender](#jsonappender)<!-- endToc -->


## Not valid json

Note that the output is technically not valid json.

 * Names and values are not quoted.
 * Newlines are not escaped.

The reason for these is that it makes approval files cleaner and easier to read and visualize/understand differences.


### UseStrictJson

To use strict json call `VerifierSettings.UseStrictJson`:

<!-- snippet: UseStrictJson -->
<a id='snippet-usestrictjson'></a>
```cs
VerifierSettings.UseStrictJson();
```
<sup><a href='/src/StrictJsonTests/Tests.cs#L11-L13' title='Snippet source file'>snippet source</a> | <a href='#snippet-usestrictjson' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Then this result in 

 * The default `.received.` and `.verified.` extensions for serialized verification to be `.json`.
 * `JsonTextWriter.QuoteChar` to be `"`.
 * `JsonTextWriter.QuoteName` to be `true`.

Then when an object is verified:

<!-- snippet: UseStrictJsonVerify -->
<a id='snippet-usestrictjsonverify'></a>
```cs
var target = new Target
{
    Value = "Foo"
};
await Verifier.Verify(target);
```
<sup><a href='/src/StrictJsonTests/Tests.cs#L31-L37' title='Snippet source file'>snippet source</a> | <a href='#snippet-usestrictjsonverify' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

The resulting file will be:

<!-- snippet: Tests.Object.verified.json -->
<a id='snippet-Tests.Object.verified.json'></a>
```json
{
  "Value": "Foo"
}
```
<sup><a href='/src/StrictJsonTests/Tests.Object.verified.json#L1-L3' title='Snippet source file'>snippet source</a> | <a href='#snippet-Tests.Object.verified.json' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## Default settings

The default `JsonSerializerSettings` are:

<!-- snippet: defaultSerialization -->
<a id='snippet-defaultserialization'></a>
```cs
JsonSerializerSettings settings = new()
{
    Formatting = Formatting.Indented,
    ReferenceLoopHandling = ReferenceLoopHandling.Ignore,
    DefaultValueHandling = DefaultValueHandling.Ignore
};
```
<sup><a href='/src/Verify/Serialization/SerializationSettings.cs#L205-L214' title='Snippet source file'>snippet source</a> | <a href='#snippet-defaultserialization' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## QuoteName is false

[JsonTextWriter.QuoteName](https://www.newtonsoft.com/json/help/html/P_Newtonsoft_Json_JsonTextWriter_QuoteName.htm) is set to false. The reason for this is that it makes approval files cleaner and easier to read and visualize/understand differences.


## Empty collections are ignored

By default empty collections are ignored during verification.

To disable this behavior globally use:

<!-- snippet: DontIgnoreEmptyCollections -->
<a id='snippet-dontignoreemptycollections'></a>
```cs
VerifierSettings.ModifySerialization(_ => _.DontIgnoreEmptyCollections());
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.cs#L274-L278' title='Snippet source file'>snippet source</a> | <a href='#snippet-dontignoreemptycollections' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## Guids are scrubbed

By default guids are sanitized during verification. This is done by finding each guid and taking a counter based that that specific guid. That counter is then used replace the guid values. This allows for repeatable tests when guid values are changing.

<!-- snippet: guid -->
<a id='snippet-guid'></a>
```cs
var guid = Guid.NewGuid();
GuidTarget target = new()
{
    Guid = guid,
    GuidNullable = guid,
    GuidString = guid.ToString(),
    OtherGuid = Guid.NewGuid(),
};

await Verifier.Verify(target);
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.cs#L479-L492' title='Snippet source file'>snippet source</a> | <a href='#snippet-guid' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Results in the following:

<!-- snippet: SerializationTests.ShouldReUseGuid.verified.txt -->
<a id='snippet-SerializationTests.ShouldReUseGuid.verified.txt'></a>
```txt
{
  Guid: Guid_1,
  GuidNullable: Guid_1,
  GuidString: Guid_1,
  OtherGuid: Guid_2
}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.ShouldReUseGuid.verified.txt#L1-L6' title='Snippet source file'>snippet source</a> | <a href='#snippet-SerializationTests.ShouldReUseGuid.verified.txt' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

To disable this behavior globally use:

<!-- snippet: DontScrubGuids -->
<a id='snippet-dontscrubguids'></a>
```cs
VerifierSettings.ModifySerialization(_ => _.DontScrubGuids());
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.cs#L283-L287' title='Snippet source file'>snippet source</a> | <a href='#snippet-dontscrubguids' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Strings containing inline Guids can also be scrubbed. To enable this behavior, use:

<!-- snippet: ScrubInlineGuids -->
<a id='snippet-scrubinlineguids'></a>
```cs
VerifierSettings.ScrubInlineGuids();
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.cs#L292-L296' title='Snippet source file'>snippet source</a> | <a href='#snippet-scrubinlineguids' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## Dates are scrubbed

By default dates (`DateTime` and `DateTimeOffset`) are sanitized during verification. This is done by finding each date and taking a counter based that that specific date. That counter is then used replace the date values. This allows for repeatable tests when date values are changing.

<!-- snippet: Date -->
<a id='snippet-date'></a>
```cs
var dateTime = DateTime.Now;
var dateTimeOffset = DateTimeOffset.Now;
DateTimeTarget target = new()
{
    DateTime = dateTime,
    DateTimeNullable = dateTime,
    DateTimeString = dateTime.ToString("F"),
    DateTimeOffset = dateTimeOffset,
    DateTimeOffsetNullable = dateTimeOffset,
    DateTimeOffsetString = dateTimeOffset.ToString("F"),
};

await Verifier.Verify(target);
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.cs#L30-L46' title='Snippet source file'>snippet source</a> | <a href='#snippet-date' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Results in the following:

<!-- snippet: SerializationTests.ShouldReUseDatetime.verified.txt -->
<a id='snippet-SerializationTests.ShouldReUseDatetime.verified.txt'></a>
```txt
{
  DateTime: DateTime_1,
  DateTimeNullable: DateTime_1,
  DateTimeOffset: DateTimeOffset_1,
  DateTimeOffsetNullable: DateTimeOffset_1,
  DateTimeString: DateTimeOffset_2,
  DateTimeOffsetString: DateTimeOffset_2
}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.ShouldReUseDatetime.verified.txt#L1-L8' title='Snippet source file'>snippet source</a> | <a href='#snippet-SerializationTests.ShouldReUseDatetime.verified.txt' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

To disable this behavior globally use:

<!-- snippet: DontScrubDateTimes -->
<a id='snippet-dontscrubdatetimes'></a>
```cs
VerifierSettings.ModifySerialization(_ => _.DontScrubDateTimes());
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.cs#L301-L305' title='Snippet source file'>snippet source</a> | <a href='#snippet-dontscrubdatetimes' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## Default Booleans are ignored

By default values of `bool` and `bool?` are ignored during verification. So properties that equate to 'false' will not be written,

To disable this behavior globally use:

<!-- snippet: DontIgnoreFalse -->
<a id='snippet-dontignorefalse'></a>
```cs
VerifierSettings.ModifySerialization(_ => _.DontIgnoreFalse());
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.cs#L310-L314' title='Snippet source file'>snippet source</a> | <a href='#snippet-dontignorefalse' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## Change defaults at the verification level

`DateTime`, `DateTimeOffset`, `Guid`, `bool`, and empty collection behavior can also be controlled at the verification level: 

<!-- snippet: ChangeDefaultsPerVerification -->
<a id='snippet-changedefaultsperverification'></a>
```cs
VerifySettings settings = new();

settings.ModifySerialization(_ =>
{
    _.DontIgnoreEmptyCollections();
    _.DontScrubGuids();
    _.DontScrubDateTimes();
    _.DontIgnoreFalse();
});
await Verify(target, settings);
```
<sup><a href='/src/Verify.MSTest.Tests/VerifyObjectSamples.cs#L17-L30' title='Snippet source file'>snippet source</a> | <a href='#snippet-changedefaultsperverification' title='Start of snippet'>anchor</a></sup>
<a id='snippet-changedefaultsperverification-1'></a>
```cs
await Verify(target)
    .ModifySerialization(_ =>
    {
        _.DontIgnoreEmptyCollections();
        _.DontScrubGuids();
        _.DontScrubDateTimes();
        _.DontIgnoreFalse();
    });
```
<sup><a href='/src/Verify.MSTest.Tests/VerifyObjectSamples.cs#L32-L43' title='Snippet source file'>snippet source</a> | <a href='#snippet-changedefaultsperverification-1' title='Start of snippet'>anchor</a></sup>
<a id='snippet-changedefaultsperverification-2'></a>
```cs
await Verifier.Verify(target)
    .ModifySerialization(_ =>
    {
        _.DontIgnoreEmptyCollections();
        _.DontScrubGuids();
        _.DontScrubDateTimes();
        _.DontIgnoreFalse();
    });
```
<sup><a href='/src/Verify.NUnit.Tests/VerifyObjectSamples.cs#L16-L27' title='Snippet source file'>snippet source</a> | <a href='#snippet-changedefaultsperverification-2' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## Changing Json.NET settings

Extra Json.NET settings can be made:


### Globally

<!-- snippet: ExtraSettingsGlobal -->
<a id='snippet-extrasettingsglobal'></a>
```cs
VerifierSettings.AddExtraSettings(_ =>
{
    _.DateFormatHandling = DateFormatHandling.MicrosoftDateFormat;
    _.TypeNameHandling = TypeNameHandling.All;
});
```
<sup><a href='/src/Verify.Tests/Snippets/Snippets.cs#L133-L141' title='Snippet source file'>snippet source</a> | <a href='#snippet-extrasettingsglobal' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### Instance

<!-- snippet: ExtraSettingsInstance -->
<a id='snippet-extrasettingsinstance'></a>
```cs
VerifySettings settings = new();
settings.AddExtraSettings(_ =>
{
    _.DateFormatHandling = DateFormatHandling.MicrosoftDateFormat;
    _.TypeNameHandling = TypeNameHandling.All;
});
```
<sup><a href='/src/Verify.Tests/Snippets/Snippets.cs#L143-L152' title='Snippet source file'>snippet source</a> | <a href='#snippet-extrasettingsinstance' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### Json.NET Converter

One common use case is to register a custom [JsonConverter](https://www.newtonsoft.com/json/help/html/CustomJsonConverter.htm). As only writing is required, to help with this there is `WriteOnlyJsonConverter`, and `WriteOnlyJsonConverter<T>`.

<!-- snippet: CompanyConverter -->
<a id='snippet-companyconverter'></a>
```cs
class CompanyConverter :
    WriteOnlyJsonConverter<Company>
{
    public override void WriteJson(
        JsonWriter writer,
        Company? company,
        JsonSerializer serializer,
        IReadOnlyDictionary<string, object> context)
    {
        if (company != null)
        {
            serializer.Serialize(writer, company.Name);
        }
    }
}
```
<sup><a href='/src/Verify.Tests/Snippets/Snippets.cs#L164-L182' title='Snippet source file'>snippet source</a> | <a href='#snippet-companyconverter' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

<!-- snippet: JsonConverter -->
<a id='snippet-jsonconverter'></a>
```cs
VerifierSettings.AddExtraSettings(_ => { _.Converters.Add(new CompanyConverter()); });
```
<sup><a href='/src/Verify.Tests/Snippets/Snippets.cs#L157-L161' title='Snippet source file'>snippet source</a> | <a href='#snippet-jsonconverter' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## Scoped settings

<!-- snippet: ScopedSerializer -->
<a id='snippet-scopedserializer'></a>
```cs
[Fact]
public Task ScopedSerializer()
{
    Person person = new()
    {
        GivenNames = "John",
        FamilyName = "Smith"
    };
    VerifySettings settings = new();
    settings.AddExtraSettings(
        _ => { _.TypeNameHandling = TypeNameHandling.All; });
    return Verifier.Verify(person, settings);
}

[Fact]
public Task ScopedSerializerFluent()
{
    Person person = new()
    {
        GivenNames = "John",
        FamilyName = "Smith"
    };
    return Verifier.Verify(person)
        .AddExtraSettings(
            _ => { _.TypeNameHandling = TypeNameHandling.All; });
}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.cs#L1214-L1243' title='Snippet source file'>snippet source</a> | <a href='#snippet-scopedserializer' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Result:

<!-- snippet: Verify.Xunit.Tests/VerifyObjectSamples.ScopedSerializer.verified.txt -->
<a id='snippet-Verify.Xunit.Tests/VerifyObjectSamples.ScopedSerializer.verified.txt'></a>
```txt
{
  $type: VerifyObjectSamples.Person,
  GivenNames: John,
  FamilyName: Smith
}
```
<sup><a href='/src/Verify.Xunit.Tests/VerifyObjectSamples.ScopedSerializer.verified.txt#L1-L5' title='Snippet source file'>snippet source</a> | <a href='#snippet-Verify.Xunit.Tests/VerifyObjectSamples.ScopedSerializer.verified.txt' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## Ignoring a type

To ignore all members that match a certain type:

<!-- snippet: AddIgnoreType -->
<a id='snippet-addignoretype'></a>
```cs
[Fact]
public async Task IgnoreType()
{
    IgnoreTypeTarget target = new()
    {
        ToIgnore = new()
        {
            Property = "Value"
        },
        ToInclude = new()
        {
            Property = "Value"
        }
    };
    VerifySettings settings = new();
    settings.ModifySerialization(_ => _.IgnoreMembersWithType<ToIgnore>());
    await Verifier.Verify(target, settings);
}

[Fact]
public async Task IgnoreTypeFluent()
{
    IgnoreTypeTarget target = new()
    {
        ToIgnore = new()
        {
            Property = "Value"
        },
        ToInclude = new()
        {
            Property = "Value"
        }
    };
    await Verifier.Verify(target)
        .ModifySerialization(_ => _.IgnoreMembersWithType<ToIgnore>());

}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.cs#L753-L793' title='Snippet source file'>snippet source</a> | <a href='#snippet-addignoretype' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Result:

<!-- snippet: SerializationTests.IgnoreType.verified.txt -->
<a id='snippet-SerializationTests.IgnoreType.verified.txt'></a>
```txt
{
  ToInclude: {
    Property: Value
  }
}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.IgnoreType.verified.txt#L1-L5' title='Snippet source file'>snippet source</a> | <a href='#snippet-SerializationTests.IgnoreType.verified.txt' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## Ignoring a instance

To ignore instances of a type based on delegate:

<!-- snippet: AddIgnoreInstance -->
<a id='snippet-addignoreinstance'></a>
```cs
[Fact]
public async Task AddIgnoreInstance()
{
    IgnoreInstanceTarget target = new()
    {
        ToIgnore = new()
        {
            Property = "Ignore"
        },
        ToInclude = new()
        {
            Property = "Include"
        }
    };
    VerifySettings settings = new();
    settings.ModifySerialization(
        _ => { _.IgnoreInstance<Instance>(x => x.Property == "Ignore"); });
    await Verifier.Verify(target, settings);
}

[Fact]
public async Task AddIgnoreInstanceFluent()
{
    IgnoreInstanceTarget target = new()
    {
        ToIgnore = new()
        {
            Property = "Ignore"
        },
        ToInclude = new()
        {
            Property = "Include"
        }
    };
    await Verifier.Verify(target)
        .ModifySerialization(
            _ => { _.IgnoreInstance<Instance>(x => x.Property == "Ignore"); });
}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.cs#L699-L740' title='Snippet source file'>snippet source</a> | <a href='#snippet-addignoreinstance' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Result:

<!-- snippet: SerializationTests.AddIgnoreInstance.verified.txt -->
<a id='snippet-SerializationTests.AddIgnoreInstance.verified.txt'></a>
```txt
{
  ToInclude: {
    Property: Include
  }
}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.AddIgnoreInstance.verified.txt#L1-L5' title='Snippet source file'>snippet source</a> | <a href='#snippet-SerializationTests.AddIgnoreInstance.verified.txt' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## Obsolete members ignored

Members with an [ObsoleteAttribute](https://docs.microsoft.com/en-us/dotnet/api/system.obsoleteattribute) are ignored:

<!-- snippet: WithObsoleteProp -->
<a id='snippet-withobsoleteprop'></a>
```cs
class WithObsolete
{
    [Obsolete]
    public string ObsoleteProperty { get; set; }

    public string OtherProperty { get; set; }
}

[Fact]
public Task WithObsoleteProp()
{
    WithObsolete target = new()
    {
        ObsoleteProperty = "value1",
        OtherProperty = "value2"
    };
    return Verifier.Verify(target);
}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.cs#L1176-L1197' title='Snippet source file'>snippet source</a> | <a href='#snippet-withobsoleteprop' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Result:

<!-- snippet: SerializationTests.WithObsoleteProp.verified.txt -->
<a id='snippet-SerializationTests.WithObsoleteProp.verified.txt'></a>
```txt
{
  OtherProperty: value2
}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.WithObsoleteProp.verified.txt#L1-L3' title='Snippet source file'>snippet source</a> | <a href='#snippet-SerializationTests.WithObsoleteProp.verified.txt' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### Including Obsolete members

Obsolete members can be included using `IncludeObsoletes`:

<!-- snippet: WithObsoletePropIncluded -->
<a id='snippet-withobsoletepropincluded'></a>
```cs
[Fact]
public Task WithObsoletePropIncluded()
{
    WithObsolete target = new()
    {
        ObsoleteProperty = "value1",
        OtherProperty = "value2"
    };
    VerifySettings settings = new();
    settings.ModifySerialization(_ => { _.IncludeObsoletes(); });
    return Verifier.Verify(target, settings);
}

[Fact]
public Task WithObsoletePropIncludedFluent()
{
    WithObsolete target = new()
    {
        ObsoleteProperty = "value1",
        OtherProperty = "value2"
    };
    return Verifier.Verify(target)
        .ModifySerialization(_ => { _.IncludeObsoletes(); });
}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.cs#L1147-L1174' title='Snippet source file'>snippet source</a> | <a href='#snippet-withobsoletepropincluded' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Result:

<!-- snippet: SerializationTests.WithObsoletePropIncluded.verified.txt -->
<a id='snippet-SerializationTests.WithObsoletePropIncluded.verified.txt'></a>
```txt
{
  ObsoleteProperty: value1,
  OtherProperty: value2
}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.WithObsoletePropIncluded.verified.txt#L1-L4' title='Snippet source file'>snippet source</a> | <a href='#snippet-SerializationTests.WithObsoletePropIncluded.verified.txt' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## Ignore member by expressions

To ignore members of a certain type using an expression:

<!-- snippet: IgnoreMemberByExpression -->
<a id='snippet-ignorememberbyexpression'></a>
```cs
[Fact]
public async Task IgnoreMemberByExpression()
{
    IgnoreExplicitTarget target = new()
    {
        Include = "Value",
        Field = "Value",
        Property = "Value"
    };
    VerifySettings settings = new();
    settings.ModifySerialization(_ =>
    {
        _.IgnoreMember<IgnoreExplicitTarget>(x => x.Property);
        _.IgnoreMember<IgnoreExplicitTarget>(x => x.Field);
        _.IgnoreMember<IgnoreExplicitTarget>(x => x.GetOnlyProperty);
        _.IgnoreMember<IgnoreExplicitTarget>(x => x.PropertyThatThrows);
    });
    await Verifier.Verify(target, settings);
}

[Fact]
public async Task IgnoreMemberByExpressionFluent()
{
    IgnoreExplicitTarget target = new()
    {
        Include = "Value",
        Field = "Value",
        Property = "Value"
    };
    await Verifier.Verify(target)
        .ModifySerialization(_ =>
        {
            _.IgnoreMember<IgnoreExplicitTarget>(x => x.Property);
            _.IgnoreMember<IgnoreExplicitTarget>(x => x.Field);
            _.IgnoreMember<IgnoreExplicitTarget>(x => x.GetOnlyProperty);
            _.IgnoreMember<IgnoreExplicitTarget>(x => x.PropertyThatThrows);
        });
}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.cs#L881-L922' title='Snippet source file'>snippet source</a> | <a href='#snippet-ignorememberbyexpression' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Result:

<!-- snippet: SerializationTests.IgnoreMemberByExpression.verified.txt -->
<a id='snippet-SerializationTests.IgnoreMemberByExpression.verified.txt'></a>
```txt
{
  Include: Value
}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.IgnoreMemberByExpression.verified.txt#L1-L3' title='Snippet source file'>snippet source</a> | <a href='#snippet-SerializationTests.IgnoreMemberByExpression.verified.txt' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## Ignore member by name

To ignore members of a certain type using type and name:

<!-- snippet: IgnoreMemberByName -->
<a id='snippet-ignorememberbyname'></a>
```cs
[Fact]
public async Task IgnoreMemberByName()
{
    IgnoreExplicitTarget target = new()
    {
        Include = "Value",
        Field = "Value",
        Property = "Value",
        PropertyByName = "Value"
    };
    VerifySettings settings = new();
    settings.ModifySerialization(_ =>
    {
        _.IgnoreMember("PropertyByName");
        var type = typeof(IgnoreExplicitTarget);
        _.IgnoreMember(type, "Property");
        _.IgnoreMember(type, "Field");
        _.IgnoreMember(type, "GetOnlyProperty");
        _.IgnoreMember(type, "PropertyThatThrows");
    });
    await Verifier.Verify(target, settings);
}

[Fact]
public async Task IgnoreMemberByNameFluent()
{
    IgnoreExplicitTarget target = new()
    {
        Include = "Value",
        Field = "Value",
        Property = "Value",
        PropertyByName = "Value"
    };
    await Verifier.Verify(target)
        .ModifySerialization(_ =>
        {
            _.IgnoreMember("PropertyByName");
            var type = typeof(IgnoreExplicitTarget);
            _.IgnoreMember(type, "Property");
            _.IgnoreMember(type, "Field");
            _.IgnoreMember(type, "GetOnlyProperty");
            _.IgnoreMember(type, "PropertyThatThrows");
        });
}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.cs#L972-L1019' title='Snippet source file'>snippet source</a> | <a href='#snippet-ignorememberbyname' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Result:

<!-- snippet: SerializationTests.IgnoreMemberByName.verified.txt -->
<a id='snippet-SerializationTests.IgnoreMemberByName.verified.txt'></a>
```txt
{
  Include: Value
}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.IgnoreMemberByName.verified.txt#L1-L3' title='Snippet source file'>snippet source</a> | <a href='#snippet-SerializationTests.IgnoreMemberByName.verified.txt' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## Members that throw

Members that throw exceptions can be excluded from serialization based on the exception type or properties.

By default members that throw `NotImplementedException` or `NotSupportedException` are ignored.

Note that this is global for all members on all types.

Ignore by exception type:

<!-- snippet: IgnoreMembersThatThrow -->
<a id='snippet-ignoremembersthatthrow'></a>
```cs
[Fact]
public async Task CustomExceptionProp()
{
    WithCustomException target = new();
    VerifySettings settings = new();
    settings.ModifySerialization(_ => _.IgnoreMembersThatThrow<CustomException>());
    await Verifier.Verify(target, settings);
}

[Fact]
public async Task CustomExceptionPropFluent()
{
    WithCustomException target = new();
    await Verifier.Verify(target)
        .ModifySerialization(_ => _.IgnoreMembersThatThrow<CustomException>());
}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.cs#L1047-L1066' title='Snippet source file'>snippet source</a> | <a href='#snippet-ignoremembersthatthrow' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Result:

<!-- snippet: SerializationTests.CustomExceptionProp.verified.txt -->
<a id='snippet-SerializationTests.CustomExceptionProp.verified.txt'></a>
```txt
{}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.CustomExceptionProp.verified.txt#L1-L1' title='Snippet source file'>snippet source</a> | <a href='#snippet-SerializationTests.CustomExceptionProp.verified.txt' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Ignore by exception type and expression:

<!-- snippet: IgnoreMembersThatThrowExpression -->
<a id='snippet-ignoremembersthatthrowexpression'></a>
```cs
[Fact]
public async Task ExceptionMessageProp()
{
    WithExceptionIgnoreMessage target = new();

    VerifySettings settings = new();
    settings.ModifySerialization(
        _ => _.IgnoreMembersThatThrow<Exception>(x => x.Message == "Ignore"));
    await Verifier.Verify(target, settings);

}

[Fact]
public async Task ExceptionMessagePropFluent()
{
    WithExceptionIgnoreMessage target = new();

    await Verifier.Verify(target)
        .ModifySerialization(
            _ => _.IgnoreMembersThatThrow<Exception>(x => x.Message == "Ignore"));
}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.cs#L645-L669' title='Snippet source file'>snippet source</a> | <a href='#snippet-ignoremembersthatthrowexpression' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Result:

<!-- snippet: SerializationTests.ExceptionMessageProp.verified.txt -->
<a id='snippet-SerializationTests.ExceptionMessageProp.verified.txt'></a>
```txt
{}
```
<sup><a href='/src/Verify.Tests/Serialization/SerializationTests.ExceptionMessageProp.verified.txt#L1-L1' title='Snippet source file'>snippet source</a> | <a href='#snippet-SerializationTests.ExceptionMessageProp.verified.txt' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## TreatAsString

Certain types, when passed directly in to Verify, are written directly without going through json serialization.

The default mapping is:

<!-- snippet: typeToStringMapping -->
<a id='snippet-typetostringmapping'></a>
```cs
{typeof(string), (target, _) => (string) target},
{typeof(bool), (target, _) => ((bool) target).ToString()},
{typeof(short), (target, _) => ((short) target).ToString()},
{typeof(ushort), (target, _) => ((ushort) target).ToString()},
{typeof(int), (target, _) => ((int) target).ToString()},
{typeof(uint), (target, _) => ((uint) target).ToString()},
{typeof(long), (target, _) => ((long) target).ToString()},
{typeof(ulong), (target, _) => ((ulong) target).ToString()},
{typeof(decimal), (target, _) => ((decimal) target).ToString(CultureInfo.InvariantCulture)},
#if NET5_0
//   {typeof(Half), (target, settings) => ((Half) target).ToString(CultureInfo.InvariantCulture)},
#endif
{typeof(float), (target, _) => ((float) target).ToString(CultureInfo.InvariantCulture)},
{typeof(double), (target, _) => ((double) target).ToString(CultureInfo.InvariantCulture)},
{typeof(Guid), (target, _) => ((Guid) target).ToString()},
{
    typeof(DateTime), (target, _) =>
    {
        var dateTime = (DateTime) target;
        return dateTime.ToString("yyyy-MM-ddTHH:mm:ss.FFFFFFFz");
    }
},
{
    typeof(DateTimeOffset), (target, _) =>
    {
        var dateTimeOffset = (DateTimeOffset) target;
        return dateTimeOffset.ToString("yyyy-MM-ddTHH:mm:ss.FFFFFFFz");
    }
},
{
    typeof(XmlNode), (target, settings) =>
    {
        var converted = (XmlNode) target;
        var document = XDocument.Parse(converted.OuterXml);
        return new(document.ToString(), "xml");
    }
},
{
    typeof(XDocument), (target, settings) =>
    {
        var converted = (XDocument) target;
        return new(converted.ToString(), "xml");
    }
}
```
<sup><a href='/src/Verify/Serialization/VerifierSettings.cs#L59-L106' title='Snippet source file'>snippet source</a> | <a href='#snippet-typetostringmapping' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

This bypasses the Guid and DateTime scrubbing mentioned above.

Extra types can be added to this mapping:

<!-- snippet: TreatAsString -->
<a id='snippet-treatasstring'></a>
```cs
VerifierSettings.TreatAsString<ClassWithToString>(
    (target, settings) => target.Property);
```
<sup><a href='/src/Verify.Tests/Snippets/Snippets.cs#L50-L55' title='Snippet source file'>snippet source</a> | <a href='#snippet-treatasstring' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## JsonAppender

A JsonAppender allows extra content (key value pairs) to be optionally appended to the output being verified. JsonAppenders can use the current context to determine what should be appended or if anything should be appended.

Register a JsonAppender:

<!-- snippet: RegisterJsonAppender -->
<a id='snippet-registerjsonappender'></a>
```cs
VerifierSettings.RegisterJsonAppender(
    context =>
    {
        if (ShouldInclude(context))
        {
            return new ToAppend("theData", "theValue");
        }

        return null;
    });
```
<sup><a href='/src/Verify.Tests/Converters/JsonAppenderTests.cs#L16-L27' title='Snippet source file'>snippet source</a> | <a href='#snippet-registerjsonappender' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

When when content is verified:

<!-- snippet: JsonAppender -->
<a id='snippet-jsonappender'></a>
```cs
[Fact]
public Task WithJsonAppender()
{
    return Verifier.Verify("TheValue");
}
```
<sup><a href='/src/Verify.Tests/Converters/JsonAppenderTests.cs#L46-L54' title='Snippet source file'>snippet source</a> | <a href='#snippet-jsonappender' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

The content from RegisterJsonAppender will be included in the output:

<!-- snippet: JsonAppenderTests.WithJsonAppender.verified.txt -->
<a id='snippet-JsonAppenderTests.WithJsonAppender.verified.txt'></a>
```txt
{
  target: TheValue,
  theData: theValue
}
```
<sup><a href='/src/Verify.Tests/Converters/JsonAppenderTests.WithJsonAppender.verified.txt#L1-L4' title='Snippet source file'>snippet source</a> | <a href='#snippet-JsonAppenderTests.WithJsonAppender.verified.txt' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

If the target is a stream or binary file:

<!-- snippet: JsonAppenderStream -->
<a id='snippet-jsonappenderstream'></a>
```cs
[Fact]
public Task Stream()
{
    return Verifier.Verify(FileHelpers.OpenRead("sample.txt"));
}
```
<sup><a href='/src/Verify.Tests/Converters/JsonAppenderTests.cs#L68-L74' title='Snippet source file'>snippet source</a> | <a href='#snippet-jsonappenderstream' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Then the appended content will be added to the `*.info.verified.txt` file:

<!-- snippet: JsonAppenderTests.Stream.info.verified.txt -->
<a id='snippet-JsonAppenderTests.Stream.info.verified.txt'></a>
```txt
{
  theData: theValue
}
```
<sup><a href='/src/Verify.Tests/Converters/JsonAppenderTests.Stream.info.verified.txt#L1-L3' title='Snippet source file'>snippet source</a> | <a href='#snippet-JsonAppenderTests.Stream.info.verified.txt' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

See [Converters](/docs/converter.md) for more information on `*.info.verified.txt` files.

Examples of extensions using JsonAppenders are [Recorders in Verify.SqlServer](https://github.com/VerifyTests/Verify.SqlServer#recording) and  [Recorders in Verify.EntityFramework](https://github.com/VerifyTests/Verify.EntityFramework#recording).
