<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /docs/mdsource/temp-file.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

## TempFile

A temporary file helper for tests that automatically cleans up files.


### Features

- Creates unique temporary files in `%TEMP%\VerifyTempFiles\{Path.GetRandomFileName()}`
- Automatic cleanup on dispose
- Implicit conversion to `string` and `FileInfo`
- Thread-safe file creation
- Removes orphaned files older than 24 hours


### Usage

<!-- snippet: TempFile -->
<a id='snippet-TempFile'></a>
```cs
[Fact]
public void Usage()
{
    using var temp = new TempFile();

    File.WriteAllText(temp, "content");

    // file automatically deleted here
}
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L38-L50' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFile' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### Orphaned files

Orphaned files can occur in the following scenario

 * A breakpoint is set in a test that uses TempFile
 * Debugger is launched and that breakpoint is hit
 * Debugger is force stopped, resulting in the `TempFile.Dispose()` not being executed


### Path Property

Contains the full path to the temporary file.

<!-- snippet: TempFilePathProperty -->
<a id='snippet-TempFilePathProperty'></a>
```cs
[Fact]
public void PathProperty()
{
    using var temp = new TempFile();
    var path = temp.Path;
    Assert.True(Path.IsPathRooted(path));
}
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L52-L62' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFilePathProperty' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### Implicit Conversion

Implicit Conversion is helpful as it allows a `TempFile` instance to be passed to directly to method that takes a `string` or a `FileInfo`.


#### String Implicit Conversion

`TempFile` can be implicitly converted to a `string`:

<!-- snippet: TempFileStringConversion -->
<a id='snippet-TempFileStringConversion'></a>
```cs
[Fact]
public void StringConversion()
{
    using var temp = new TempFile();

    File.WriteAllText(temp, "content");

    // implicit conversion to string
    string path = temp;
    var content = File.ReadAllText(path);
    Trace.WriteLine(content);
}
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L344-L359' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFileStringConversion' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


#### FileInfo Implicit Conversion

`TempFile` can be implicitly converted to a `FileInfo`:

<!-- snippet: TempFileFileInfoConversion -->
<a id='snippet-TempFileFileInfoConversion'></a>
```cs
[Fact]
public void FileInfoConversion()
{
    using var temp = new TempFile();

    // implicit conversion to FileInfo
    FileInfo info = temp;

    var directoryName = info.DirectoryName;
    Trace.WriteLine(directoryName);
}
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L361-L375' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFileFileInfoConversion' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### Info Property

`TempFile` has a convenience `Info` that can be used to access all the `FileInfo` members:

<!-- snippet: TempFileInfoProperty -->
<a id='snippet-TempFileInfoProperty'></a>
```cs
[Fact]
public void InfoProperty()
{
    using var temp = new TempFile();

    var directoryName = temp.Info.DirectoryName;

    Trace.WriteLine(directoryName);
}
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L377-L389' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFileInfoProperty' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### TempFile RootDirectory Property

Allows access to the root directory for all TempFile instances:

<!-- snippet: TempFileRootDirectory -->
<a id='snippet-TempFileRootDirectory'></a>
```cs
[Fact]
public void RootDirectory() =>
    // Accessing the root directory for all TempDirectory instances
    Trace.WriteLine(TempFile.RootDirectory);
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L114-L121' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFileRootDirectory' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### Cleanup Behavior

The dispose cleans up the current instance.

The static constructor automatically:

1. Ensures the root directory `%TEMP%\VerifyTempFiles` exists
1. Deletes files not modified in the last 24 hours
1. Runs once per application domain


### Thread Safety

Each instance creates a unique file using `Path.GetRandomFileName()`, making concurrent usage safe.


### VerifyFile

`TempFile` is compatible with [VerifyFile](/docs/verify-file.md).

<!-- snippet: VerifyTempFile -->
<a id='snippet-VerifyTempFile'></a>
```cs
[Fact]
public async Task VerifyFileInstance()
{
    using var file = new TempFile("txt");
    await File.WriteAllTextAsync(file, "test");
    await VerifyFile(file);
}
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L26-L36' title='Snippet source file'>snippet source</a> | <a href='#snippet-VerifyTempFile' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### TempFile paths are scrubbed

<!-- snippet: TempFileScrubbing -->
<a id='snippet-TempFileScrubbing'></a>
```cs
[Fact]
public async Task Scrubbing()
{
    using var temp = new TempFile();

    await Verify(new
    {
        PropertyWithTempPath = temp,
        TempInStringProperty = $"The path is {temp}"
    });
}
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L96-L110' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFileScrubbing' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

Result:

<!-- snippet: TempFileTests.Scrubbing.verified.txt -->
<a id='snippet-TempFileTests.Scrubbing.verified.txt'></a>
```txt
{
  PropertyWithTempPath: {TempFile},
  TempInStringProperty: The path is {TempFile}
}
```
<sup><a href='/src/Verify.Tests/TempFileTests.Scrubbing.verified.txt#L1-L4' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFileTests.Scrubbing.verified.txt' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### Create Method

Creates a new temporary file with optional extension and encoding.

<!-- snippet: TempFileCreate -->
<a id='snippet-TempFileCreate'></a>
```cs
using var temp = TempFile.Create();

File.WriteAllText(temp, "content");

// file automatically deleted here
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L620-L628' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFileCreate' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


#### With Extension

Create a temporary file with a specific extension:

<!-- snippet: TempFileCreateWithExtension -->
<a id='snippet-TempFileCreateWithExtension'></a>
```cs
using var temp = TempFile.Create(".txt");

File.WriteAllText(temp, "content");
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L635-L641' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFileCreateWithExtension' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


#### With Encoding

Create a temporary file with a specific text encoding and BOM:

<!-- snippet: TempFileCreateWithEncoding -->
<a id='snippet-TempFileCreateWithEncoding'></a>
```cs
using var temp = TempFile.Create(".txt", Encoding.UTF8);

File.Exists(temp.Path);
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L649-L655' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFileCreateWithEncoding' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### CreateText Method

Creates a new temporary file with text content asynchronously.

<!-- snippet: TempFileCreateText -->
<a id='snippet-TempFileCreateText'></a>
```cs
using var temp = await TempFile.CreateText("Hello, World!");

var content = await File.ReadAllTextAsync(temp);
Assert.Equal("Hello, World!", content);
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L661-L668' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFileCreateText' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


#### With Extension

<!-- snippet: TempFileCreateTextWithExtension -->
<a id='snippet-TempFileCreateTextWithExtension'></a>
```cs
var json = """
           {
             "name": "test",
             "value": 123
           }
           """;

using var temp = await TempFile.CreateText(json, ".json");

var content = await File.ReadAllTextAsync(temp);
Assert.Equal(json, content);
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L674-L688' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFileCreateTextWithExtension' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


#### With Encoding

Create a text file with specific encoding:

<!-- snippet: TempFileCreateTextWithEncoding -->
<a id='snippet-TempFileCreateTextWithEncoding'></a>
```cs
using var temp = await TempFile.CreateText(
    "Content with special chars: äöü",
    ".txt",
    Encoding.UTF8);

var content = await File.ReadAllTextAsync(temp, Encoding.UTF8);
Assert.Equal("Content with special chars: äöü", content);
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L694-L704' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFileCreateTextWithEncoding' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### CreateBinary Method

Creates a new temporary file with binary content asynchronously.

<!-- snippet: TempFileCreateBinary -->
<a id='snippet-TempFileCreateBinary'></a>
```cs
byte[] data = [0x01, 0x02, 0x03, 0x04];

using var temp = await TempFile.CreateBinary(data);

var readData = await File.ReadAllBytesAsync(temp);
Assert.Equal(data, readData);
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L712-L721' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFileCreateBinary' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


#### With Extension

<!-- snippet: TempFileCreateBinaryWithExtension -->
<a id='snippet-TempFileCreateBinaryWithExtension'></a>
```cs
using var temp = await TempFile.CreateBinary(imageBinaryData, ".png");

// Process the temporary image file
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L729-L735' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFileCreateBinaryWithExtension' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### Debugging

Given `TempFile` deletes the file on test completion (even failure), it can be difficult to debug what caused the failure.

There are several approaches that can be used to inspect the contents of the temp file.

**The below should be considered temporary approaches to be used only during debugging. The code should not be committed to source control.**


#### No Using

Omitting the `using` for the TempFile will prevent the temp file from being deleted when the test finished.

<!-- snippet: TempFileNoUsing -->
<a id='snippet-TempFileNoUsing'></a>
```cs
[Fact(Explicit = true)]
public void NoUsing()
{
    //using var temp = new TempFile();
    var temp = new TempFile();

    File.WriteAllText(temp, "content");

    Debug.WriteLine(temp);
}
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L79-L92' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFileNoUsing' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

The file can then be manually inspected.


#### OpenExplorerAndDebug

Opens the temporary file in the system file explorer and breaks into the debugger.

<!-- snippet: TempFileOpenExplorerAndDebug -->
<a id='snippet-TempFileOpenExplorerAndDebug'></a>
```cs
[Fact(Explicit = true)]
public void OpenExplorerAndDebug()
{
    using var temp = new TempFile();

    File.WriteAllText(temp, "content");

    // this is temporary debugging code and should not be commited to source control
    temp.OpenExplorerAndDebug();
}
```
<sup><a href='/src/Verify.Tests/TempFileTests.cs#L64-L77' title='Snippet source file'>snippet source</a> | <a href='#snippet-TempFileOpenExplorerAndDebug' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

This method is designed to help debug tests by enabling the inspection of the contents of the temporary file while the test is paused. It performs two actions:

 1. **Opens the file in the file explorer** - Launches the system's default file explorer (Explorer on Windows, Finder on macOS) and navigates to the temporary file
 1. **Breaks into the debugger** - If a debugger is already attached, execution breaks at this point. If no debugger is attached, it attempts to launch one. This prevents the file being clean up by the `TempFile.Dispose()`.

This enables examination of the file contents at a specific point during test execution.

Supported Platforms:

 * Windows (uses `explorer.exe`)
 * macOS (uses `open`)

Throws an exception if used on a build server. Uses `DiffEngine.BuildServerDetector.Detected`.


##### Rider

For `Debugger.Launch();` to work correctly in JetBrains Rider use [Set Rider as the default debugger](https://www.jetbrains.com/help/rider/Settings_Debugger.html#dotNet).
